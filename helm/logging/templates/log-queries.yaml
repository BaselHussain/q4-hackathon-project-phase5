apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-predefined-queries
  labels:
    app: loki
    component: queries
data:
  queries.json: |
    {
      "queries": [
        {
          "name": "Task Creation Failed",
          "description": "Find all failed task creation attempts across services",
          "query": "{namespace=\"default\"} |= \"Task creation\" |= \"error\" | json"
        },
        {
          "name": "Event Publishing Failed",
          "description": "Find all Dapr event publishing failures",
          "query": "{namespace=\"default\"} |= \"Event publishing failed\" | json"
        },
        {
          "name": "WebSocket Connection Lost",
          "description": "Find WebSocket disconnection events",
          "query": "{namespace=\"default\", service=\"sync-service\"} |= \"disconnect\" | json"
        },
        {
          "name": "Authentication Failures",
          "description": "Find all failed login and auth attempts",
          "query": "{namespace=\"default\"} |= \"failed_login\" | json"
        },
        {
          "name": "Database Errors",
          "description": "Find all database connection and query errors",
          "query": "{namespace=\"default\"} |= \"Database\" |= \"error\" | json"
        },
        {
          "name": "Dapr Sidecar Errors",
          "description": "Find errors from Dapr sidecars across all services",
          "query": "{namespace=\"default\", container=\"daprd\"} |= \"error\" | json"
        },
        {
          "name": "Recurring Task Processing",
          "description": "Track recurring task creation events",
          "query": "{namespace=\"default\", service=\"recurring-task-service\"} |= \"recurring\" | json"
        },
        {
          "name": "Reminder Scheduling",
          "description": "Track reminder scheduling and delivery",
          "query": "{namespace=\"default\", service=\"notification-service\"} |= \"reminder\" | json"
        },
        {
          "name": "Audit Log Writes",
          "description": "Track audit log write operations",
          "query": "{namespace=\"default\", service=\"audit-service\"} |= \"audit\" | json"
        },
        {
          "name": "High Latency Requests",
          "description": "Find requests taking longer than 1 second",
          "query": "{namespace=\"default\", service=\"backend\"} | json | duration > 1s"
        },
        {
          "name": "All Errors (Last Hour)",
          "description": "Find all ERROR level logs across all services",
          "query": "{namespace=\"default\"} | json | level = \"ERROR\""
        },
        {
          "name": "User Activity Trace",
          "description": "Trace all operations for a specific user (replace USER_ID)",
          "query": "{namespace=\"default\"} |= \"USER_ID\" | json"
        }
      ]
    }
